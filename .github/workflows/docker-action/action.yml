name: Setup Docker Environment

description: 'Action for setting up the Docker Environment'

runs:
  using: 'composite'
  steps:
  - name: Add JWT Settings Secret Key
    run: |
      sed -i "s/\"SecretKey\": \"\"/\"SecretKey\": \"${{ secret-key }}\"/g" ./src/ConsiliumTempus.Api/appsettings.json

  - name: Copy Environment File (.env)
    run: cp .env.dev .env

  - name: Run Docker Containers
    run: docker compose -f docker-compose-prod.yml up -d

  - name: Permission on all scripts
    run: chmod +x ./scripts/*.sh

  - name: Apply Database Migrations to the Docker Container
    run: ./scripts/apply-migration-to-database.sh
